# Diagrama de Fluxo: ClÃ­nica e MÃ©dicos

## ğŸ“Œ Estado Final do UsuÃ¡rio

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     NOVO USUÃRIO NO COGNITO                 â”‚
â”‚                                                             â”‚
â”‚  Faz login â†’ Role = INDIVIDUAL, Clinic = null               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                     â”‚                        â”‚
           â–¼                                     â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CRIA CLÃNICA    â”‚    â”‚  RECEBE CONVITE DE CLÃNICA  â”‚    â”‚ CONTINUA SEM     â”‚
    â”‚                  â”‚    â”‚                             â”‚    â”‚ CLÃNICA          â”‚
    â”‚ POST /clinics/   â”‚    â”‚ DoctorInvitation.status =   â”‚    â”‚                  â”‚
    â”‚                  â”‚    â”‚ PENDING                     â”‚    â”‚ Permanece como   â”‚
    â”‚ Role: INDIVIDUAL â”‚    â”‚                             â”‚    â”‚ INDIVIDUAL       â”‚
    â”‚   â†“â†“â†“â†“â†“â†“â†“        â”‚    â”‚ Faz login com email         â”‚    â”‚                  â”‚
    â”‚ Role: ADMIN      â”‚    â”‚ convidado                   â”‚    â”‚ upload prÃ³prio   â”‚
    â”‚ Clinic: X        â”‚    â”‚   â†“â†“â†“â†“â†“â†“â†“                   â”‚    â”‚                  â”‚
    â”‚                  â”‚    â”‚ Role: CLINIC_DOCTOR         â”‚    â”‚                  â”‚
    â”‚ Agora Ã© dono da  â”‚    â”‚ Clinic: X                   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ clÃ­nica e pode   â”‚    â”‚ (AUTO-ACCEPTED)             â”‚
    â”‚ convidar mÃ©dicos â”‚    â”‚                             â”‚
    â”‚                  â”‚    â”‚ ou                          â”‚
    â”‚                  â”‚    â”‚                             â”‚
    â”‚ AÃ§Ãµes:           â”‚    â”‚ POST /accept/invitation     â”‚
    â”‚ - Convidar       â”‚    â”‚ (aceitar manualmente)       â”‚
    â”‚ - Remover mÃ©dico â”‚    â”‚                             â”‚
    â”‚ - Listar mÃ©dicos â”‚    â”‚ AÃ§Ãµes:                      â”‚
    â”‚ - Upload estudo  â”‚    â”‚ - Ver convites              â”‚
    â”‚                  â”‚    â”‚ - Upload de estudo          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ - Ver pacientes da clÃ­nica  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Fluxo Completo de Cadastro de ClÃ­nica

```
1. USUÃRIO FAZ LOGIN NO COGNITO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Email: owner@example.com            â”‚
   â”‚ Password: OwnerPassword123!         â”‚
   â”‚ â†’ Access Token recebido             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ BACKEND: Valida JWT                 â”‚
   â”‚ - Cria User (cognito_sub, email)    â”‚
   â”‚ - Role = 'INDIVIDUAL'               â”‚
   â”‚ - Clinic = null                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend retorna User info           â”‚
   â”‚ Role: INDIVIDUAL, Clinic: null      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
2. USUÃRIO CRIA CLÃNICA
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /api/clinics/clinics/          â”‚
   â”‚ Body: {name, cnpj, seat_limit}      â”‚
   â”‚ Authorization: Bearer $TOKEN        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ VERIFICAÃ‡Ã•ES:                       â”‚
   â”‚ âœ“ User already has clinic? NO       â”‚
   â”‚ âœ“ User already owns clinic? NO      â”‚
   â”‚ âœ“ Seat limit suficiente? SIM        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ CRIA CLÃNICA:                       â”‚
   â”‚ Clinic.name = "ClÃ­nica Health"      â”‚
   â”‚ Clinic.owner = User (request.user)  â”‚
   â”‚ Clinic.seat_limit = 10              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ATUALIZA USUÃRIO:                   â”‚
   â”‚ User.role = 'CLINIC_ADMIN'          â”‚
   â”‚ User.clinic = Clinic object         â”‚
   â”‚ User.save()                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ RETORNA RESPOSTA ao frontend:       â”‚
   â”‚ {                                   â”‚
   â”‚   "id": "clinic-uuid",              â”‚
   â”‚   "name": "ClÃ­nica Health",         â”‚
   â”‚   "owner": {                        â”‚
   â”‚     "email": "owner@example.com",   â”‚
   â”‚     "role": "CLINIC_ADMIN",         â”‚
   â”‚     "clinic_id": "clinic-uuid"      â”‚
   â”‚   },                                â”‚
   â”‚   "seat_limit": 10                  â”‚
   â”‚ }                                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¥ Fluxo de Convite e Auto-Accept

```
3. CLINIC_ADMIN CONVIDA MÃ‰DICO
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /api/clinics/clinics/invite/   â”‚
   â”‚ Body: {"email": "doctor@ex.com"}    â”‚
   â”‚ Authorization: Bearer $ADMIN_TOKEN  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ VERIFICAÃ‡Ã•ES:                       â”‚
   â”‚ âœ“ User is CLINIC_ADMIN? SIM         â”‚
   â”‚ âœ“ Clinic seat limit? OK             â”‚
   â”‚ âœ“ Convite duplicado? NÃƒO            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ CRIA CONVITE:                       â”‚
   â”‚ DoctorInvitation.clinic = Clinic    â”‚
   â”‚ DoctorInvitation.email = "doctor..."â”‚
   â”‚ DoctorInvitation.status = 'PENDING' â”‚
   â”‚ DoctorInvitation.expires_at = +7d   â”‚
   â”‚ DoctorInvitation.invited_by = User  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼ (Opcionalmente envia email)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ RESPOSTA:                           â”‚
   â”‚ {                                   â”‚
   â”‚   "id": "invitation-uuid",          â”‚
   â”‚   "clinic_name": "ClÃ­nica Health",  â”‚
   â”‚   "email": "doctor@example.com",    â”‚
   â”‚   "status": "PENDING",              â”‚
   â”‚   "expires_at": "2026-02-27T..."    â”‚
   â”‚ }                                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. MÃ‰DICO FAZ LOGIN (com email convidado)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ aws cognito-idp admin-initiate-auth  â”‚
   â”‚ Username: doctor@example.com         â”‚
   â”‚ Password: DoctorPassword123!         â”‚
   â”‚ â†’ Access Token gerado pelo Cognito   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ BACKEND: validate JWT token          â”‚
   â”‚ (CognitoJWTAuthentication)           â”‚
   â”‚ 1. Valida assinatura                 â”‚
   â”‚ 2. Valida issuer/audience            â”‚
   â”‚ 3. Extrai claims (sub, email, etc)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ CRIA/ATUALIZA USUÃRIO:               â”‚
   â”‚ User.cognito_sub = claims['sub']     â”‚
   â”‚ User.email = "doctor@example.com"    â”‚
   â”‚ User.role = 'INDIVIDUAL'  (default)  â”‚
   â”‚ (save primeiro com role INDIVIDUAL)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼ ğŸ‘ˆ AQUI ACONTECE A MÃGICA
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ AUTO-ACCEPT LOGIC:                   â”‚
   â”‚ if User.clinic is None and           â”‚
   â”‚    User.role == 'INDIVIDUAL':        â”‚
   â”‚    â†’ Query DoctorInvitation para     â”‚
   â”‚      email = "doctor@example.com"    â”‚
   â”‚      status = 'PENDING'              â”‚
   â”‚                                      â”‚
   â”‚ if encontrou_convite:                â”‚
   â”‚    âœ“ invitation.accept()             â”‚
   â”‚    âœ“ invitation.status='ACCEPTED'    â”‚
   â”‚    âœ“ User.clinic = invitation.clinic â”‚
   â”‚    âœ“ User.role = 'CLINIC_DOCTOR'     â”‚
   â”‚    âœ“ User.save()                     â”‚
   â”‚                                      â”‚
   â”‚ â­ LOG:                              â”‚
   â”‚ "âœ“ Auto-accepted invitation for      â”‚
   â”‚  doctor@example.com to clinic        â”‚
   â”‚  ClÃ­nica Health"                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ RETORNA PARA FRONTEND:               â”‚
   â”‚ {                                    â”‚
   â”‚   "email": "doctor@example.com",     â”‚
   â”‚   "role": "CLINIC_DOCTOR",           â”‚
   â”‚   "clinic_id": "clinic-uuid",        â”‚
   â”‚ }                                    â”‚
   â”‚                                      â”‚
   â”‚ âœ… MÃ‰DICO AGORA PODE:                â”‚
   â”‚   - Upload estudos da clÃ­nica        â”‚
   â”‚   - Ver pacientes da clÃ­nica         â”‚
   â”‚   - Ver outros mÃ©dicos da clÃ­nica    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Tabela de Estados PossÃ­veis

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User.role        â”‚ User.clinic       â”‚ Estado         â”‚ AÃ§Ãµes PossÃ­veis  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INDIVIDUAL       â”‚ null              â”‚ Novo UsuÃ¡rio   â”‚ Criar clÃ­nica    â”‚
â”‚                  â”‚                   â”‚ ou Convidado   â”‚ Ver convites     â”‚
â”‚                  â”‚                   â”‚ pendente       â”‚ Upload prÃ³prio   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CLINIC_ADMIN     â”‚ Clinic X          â”‚ Dono/Admin     â”‚ Convidar mÃ©dicos â”‚
â”‚                  â”‚                   â”‚ da ClÃ­nica X   â”‚ Remover mÃ©dicos  â”‚
â”‚                  â”‚                   â”‚                â”‚Listar mÃ©dicos    â”‚
â”‚                  â”‚                   â”‚                â”‚ Upload estudo    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CLINIC_DOCTOR    â”‚ Clinic X          â”‚ MÃ©dico na      â”‚ Ver convite      â”‚
â”‚                  â”‚                   â”‚ ClÃ­nica X      â”‚ (jÃ¡ aceito)      â”‚
â”‚                  â”‚                   â”‚                â”‚ Upload estudo    â”‚
â”‚                  â”‚                   â”‚                â”‚ Ver pacientes    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INDIVIDUAL       â”‚ null              â”‚ Independente   â”‚ Upload prÃ³prio   â”‚
â”‚                  â”‚   (permanente)    â”‚ sem clÃ­nica    â”‚ Ver seus estudos â”‚
â”‚                  â”‚                   â”‚                â”‚ Criar clÃ­nica    â”‚
â”‚                  â”‚                   â”‚                â”‚ (vira ADMIN)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ DecisÃ£o de Design: Por que Auto-Accept?

**Problema:** MÃ©dico recebe convite, faz login, mas precisa aceitar manualmente. UX ruim.

**SoluÃ§Ã£o:** Auto-accept na middleware de autenticaÃ§Ã£o:
```python
# Em CognitoJWTAuthentication.authenticate_credentials()

# Quando usuÃ¡rio faz login com JWT vÃ¡lido:
1. Valida token
2. Cria/atualiza usuÃ¡rio
3. Verifica se hÃ¡ convites PENDING para esse email
4. SE HOUVER E NÃƒO EXPIROU:
   - Auto-aceita o convite
   - Muda role para CLINIC_DOCTOR
   - Vincula Ã  clÃ­nica
5. Retorna usuÃ¡rio com role/clinic atualizados
```

**BenefÃ­cios:**
- âœ… UX transparente
- âœ… Convite aceito automaticamente no primeiro login
- âœ… MÃ©dico nÃ£o precisa fazer nada alÃ©m de login
- âœ… Log detalhado de auto-accepts

**Fallback:** Se precise aceitar manualmente, endpoint `/accept/` ainda existe.

---

## ğŸ” SeguranÃ§a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PERMISSÃ•ES POR ROLE                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ INDIVIDUAL                                                  â”‚
â”‚ â”œâ”€ POST /clinics/  (cria â†’ vira CLINIC_ADMIN)               â”‚
â”‚ â”œâ”€ GET /invitations/my_invitations/                         â”‚
â”‚ â”œâ”€ POST /invitations/{id}/accept/                           â”‚
â”‚ â””â”€ POST /studies/upload/ (seus prÃ³prios)                    â”‚
â”‚                                                             â”‚
â”‚ CLINIC_ADMIN                                                â”‚
â”‚ â”œâ”€ POST /clinics/invite/ (convidar mÃ©dicos)                 â”‚
â”‚ â”œâ”€ GET /clinics/doctors/ (listar mÃ©dicos)                   â”‚
â”‚ â”œâ”€ DELETE /clinics/remove_doctor/ (remover)                 â”‚
â”‚ â”œâ”€ GET /clinics/ (informaÃ§Ãµes da clÃ­nica)                   â”‚
â”‚ â””â”€ POST /studies/upload/ (da clÃ­nica)                       â”‚
â”‚                                                             â”‚
â”‚ CLINIC_DOCTOR                                               â”‚
â”‚ â”œâ”€ GET /invitations/my_invitations/                         â”‚
â”‚ â”œâ”€ POST /studies/upload/ (da clÃ­nica)                       â”‚
â”‚ â””â”€ GET /studies/ (da clÃ­nica)                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Resumo para Desenvolvedor

1. **UsuÃ¡rio novo** = INDIVIDUAL, sem clÃ­nica
2. **Cria clÃ­nica** = Vira CLINIC_ADMIN
3. **Envia convite** = DoctorInvitation.PENDING
4. **MÃ©dico loga com email convidado** = Auto-aceita, vira CLINIC_DOCTOR
5. **Independente** = Permanece INDIVIDUAL, sem clÃ­nica

Tudo automÃ¡tico na middleware! Simples assim. ğŸš€
